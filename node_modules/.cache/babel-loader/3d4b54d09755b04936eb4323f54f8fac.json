{"remainingRequest":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\src\\views\\ums\\role\\allocMenu.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\src\\views\\ums\\role\\allocMenu.vue","mtime":1712845525807},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\babel.config.js","mtime":1710918909587},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710918915895},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\babel-loader\\lib\\index.js","mtime":1710918914227},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710918915895},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\vue-loader\\lib\\index.js","mtime":1710918931244}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IGZldGNoVHJlZUxpc3QgfSBmcm9tICdAL2FwaS9tZW51JzsKaW1wb3J0IHsgbGlzdE1lbnVCeVJvbGUsIGFsbG9jTWVudSB9IGZyb20gJ0AvYXBpL3JvbGUnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImFsbG9jTWVudSIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG1lbnVUcmVlTGlzdDogW10sCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAndGl0bGUnCiAgICAgIH0sCiAgICAgIHJvbGVJZDogbnVsbAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnJvbGVJZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnJvbGVJZDsKICAgIHRoaXMudHJlZUxpc3QoKTsKICAgIHRoaXMuZ2V0Um9sZU1lbnUodGhpcy5yb2xlSWQpOwogIH0sCiAgbWV0aG9kczogewogICAgdHJlZUxpc3QoKSB7CiAgICAgIGZldGNoVHJlZUxpc3QoKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLm1lbnVUcmVlTGlzdCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgIH0pOwogICAgfSwKICAgIGdldFJvbGVNZW51KHJvbGVJZCkgewogICAgICBsaXN0TWVudUJ5Um9sZShyb2xlSWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGxldCBtZW51TGlzdCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgbGV0IGNoZWNrZWRNZW51SWRzID0gW107CiAgICAgICAgaWYgKG1lbnVMaXN0ICE9IG51bGwgJiYgbWVudUxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51TGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBsZXQgbWVudSA9IG1lbnVMaXN0W2ldOwogICAgICAgICAgICAvLyDlsIbmiYDmnInoj5zljZVJROa3u+WKoOWIsGNoZWNrZWRNZW51SWRz5Lit77yM5YyF5ous5LiA57qn6I+c5Y2VCiAgICAgICAgICAgIGNoZWNrZWRNZW51SWRzLnB1c2gobWVudS5pZCk7CiAgICAgICAgICAgIC8vIOWmguaenOWtmOWcqOeItklE77yM5Lmf5bCG5YW25re75Yqg5YiwY2hlY2tlZE1lbnVJZHPkuK0KICAgICAgICAgICAgaWYgKG1lbnUucGFyZW50SWQgIT09IDApIHsKICAgICAgICAgICAgICBjaGVja2VkTWVudUlkcy5wdXNoKG1lbnUucGFyZW50SWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIOS9v+eUqFNldOadpeWOu+mZpOmHjeWkjeeahElECiAgICAgICAgbGV0IHVuaXF1ZUNoZWNrZWRNZW51SWRzID0gbmV3IFNldChjaGVja2VkTWVudUlkcyk7CiAgICAgICAgdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWRLZXlzKEFycmF5LmZyb20odW5pcXVlQ2hlY2tlZE1lbnVJZHMpKTsKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlU2F2ZSgpIHsKICAgICAgbGV0IGNoZWNrZWROb2RlcyA9IHRoaXMuJHJlZnMudHJlZS5nZXRDaGVja2VkTm9kZXMoKTsKICAgICAgbGV0IGNoZWNrZWRNZW51SWRzID0gbmV3IFNldCgpOwogICAgICBpZiAoY2hlY2tlZE5vZGVzICE9IG51bGwgJiYgY2hlY2tlZE5vZGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoZWNrZWROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgbGV0IGNoZWNrZWROb2RlID0gY2hlY2tlZE5vZGVzW2ldOwogICAgICAgICAgY2hlY2tlZE1lbnVJZHMuYWRkKGNoZWNrZWROb2RlLmlkKTsKICAgICAgICAgIGlmIChjaGVja2VkTm9kZS5wYXJlbnRJZCAhPT0gMCkgewogICAgICAgICAgICBjaGVja2VkTWVudUlkcy5hZGQoY2hlY2tlZE5vZGUucGFyZW50SWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLiRjb25maXJtKCfmmK/lkKbliIbphY3oj5zljZXvvJ8nLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgbGV0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTsKICAgICAgICBwYXJhbXMuYXBwZW5kKCJyb2xlSWQiLCB0aGlzLnJvbGVJZCk7CiAgICAgICAgcGFyYW1zLmFwcGVuZCgibWVudUlkcyIsIEFycmF5LmZyb20oY2hlY2tlZE1lbnVJZHMpKTsKICAgICAgICBhbGxvY01lbnUocGFyYW1zKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiAn5YiG6YWN5oiQ5YqfJywKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgICBkdXJhdGlvbjogMTAwMAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLiRyb3V0ZXIuYmFjaygpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVDbGVhcigpIHsKICAgICAgdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWRLZXlzKFtdKTsKICAgIH0KICB9Cn07"},{"version":3,"mappings":";AAcA;AACA;AAEA;EACAA;EACAC;IACA;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;IACA;EACA;EACAC;IACA;IACA;IACA;EACA;EACAC;IACAC;MACAC;QACA;MACA;IACA;IACAC;MACAC;QACA;QACA;QACA;UACA;YACA;YACA;YACAC;YACA;YACA;cACAA;YACA;UACA;QACA;QACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;QACA;UACA;UACAD;UACA;YACAA;UACA;QACA;MACA;MACA;QACAE;QACAC;QACAC;MACA;QACA;QACAC;QACAA;QACAC;UACA;YACAC;YACAH;YACAI;UACA;UACA;QACA;MACA;IACA;IACAC;MACA;IACA;EACA;AACA","names":["name","data","menuTreeList","defaultProps","children","label","roleId","created","methods","treeList","fetchTreeList","getRoleMenu","listMenuByRole","checkedMenuIds","handleSave","confirmButtonText","cancelButtonText","type","params","allocMenu","message","duration","handleClear"],"sourceRoot":"src/views/ums/role","sources":["allocMenu.vue"],"sourcesContent":["<template>\n  <el-card class=\"form-container\" shadow=\"never\">\n    <el-tree :data=\"menuTreeList\" show-checkbox default-expand-all node-key=\"id\" ref=\"tree\" highlight-current\n      :props=\"defaultProps\">\n    </el-tree>\n    <div style=\"margin-top: 20px\" align=\"center\">\n      <el-button type=\"primary\" @click=\"handleSave()\">保存</el-button>\n      <el-button @click=\"handleClear()\">清空</el-button>\n    </div>\n\n  </el-card>\n</template>\n\n<script>\nimport { fetchTreeList } from '@/api/menu';\nimport { listMenuByRole, allocMenu } from '@/api/role';\n\nexport default {\n  name: \"allocMenu\",\n  data() {\n    return {\n      menuTreeList: [],\n      defaultProps: {\n        children: 'children',\n        label: 'title'\n      },\n      roleId: null\n    };\n  },\n  created() {\n    this.roleId = this.$route.query.roleId;\n    this.treeList();\n    this.getRoleMenu(this.roleId);\n  },\n  methods: {\n    treeList() {\n      fetchTreeList().then(response => {\n        this.menuTreeList = response.data;\n      });\n    },\n    getRoleMenu(roleId) {\n      listMenuByRole(roleId).then(response => {\n        let menuList = response.data;\n        let checkedMenuIds = [];\n        if (menuList != null && menuList.length > 0) {\n          for (let i = 0; i < menuList.length; i++) {\n            let menu = menuList[i];\n            // 将所有菜单ID添加到checkedMenuIds中，包括一级菜单\n            checkedMenuIds.push(menu.id);\n            // 如果存在父ID，也将其添加到checkedMenuIds中\n            if (menu.parentId !== 0) {\n              checkedMenuIds.push(menu.parentId);\n            }\n          }\n        }\n        // 使用Set来去除重复的ID\n        let uniqueCheckedMenuIds = new Set(checkedMenuIds);\n        this.$refs.tree.setCheckedKeys(Array.from(uniqueCheckedMenuIds));\n      });\n    },\n    handleSave() {\n      let checkedNodes = this.$refs.tree.getCheckedNodes();\n      let checkedMenuIds = new Set();\n      if (checkedNodes != null && checkedNodes.length > 0) {\n        for (let i = 0; i < checkedNodes.length; i++) {\n          let checkedNode = checkedNodes[i];\n          checkedMenuIds.add(checkedNode.id);\n          if (checkedNode.parentId !== 0) {\n            checkedMenuIds.add(checkedNode.parentId);\n          }\n        }\n      }\n      this.$confirm('是否分配菜单？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        let params = new URLSearchParams();\n        params.append(\"roleId\", this.roleId);\n        params.append(\"menuIds\", Array.from(checkedMenuIds));\n        allocMenu(params).then(response => {\n          this.$message({\n            message: '分配成功',\n            type: 'success',\n            duration: 1000\n          });\n          this.$router.back();\n        })\n      })\n    },\n    handleClear() {\n      this.$refs.tree.setCheckedKeys([]);\n    }\n  }\n}\n</script>\n\n<style scoped></style>\n"]}]}