{"remainingRequest":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\86198\\Desktop\\qianduantongzhan\\src\\views\\ums\\role\\allocResource.vue?vue&type=style&index=0&id=99660c50&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\src\\views\\ums\\role\\allocResource.vue","mtime":1694958188000},{"path":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1655715156000},{"path":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86198\\Desktop\\qianduantongzhan\\node_modules\\vue-loader\\lib\\index.js","mtime":1655715100000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci50YWJsZS1sYXlvdXQgewogIHBhZGRpbmc6IDIwcHg7CiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjZGNkZmU2OwogIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNkY2RmZTY7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkY2RmZTY7Cn0KCi50b3AtbGluZSB7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNkY2RmZTY7Cn0KLyogLnRhYmxlLSB7CiAgZGlzcGxheTogYmxvY2s7CiAgbWFyZ2luOiA2MHB4Owp9Ci5mb3JtLWNvbnRhaW5lciB7CiAgaGVpZ2h0OiA3MDBweDsKICBkaXNwbGF5OiBibG9jazsKfSAqLwo="},{"version":3,"sources":["allocResource.vue"],"names":[],"mappings":";AAqMA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"allocResource.vue","sourceRoot":"src/views/ums/role","sourcesContent":["<template>\n  <!-- 使用Element UI的el-card组件创建卡片容器 -->\n  <el-card class=\"form-container\" shadow=\"never\">\n    <!-- 遍历资源分类 -->\n    <div class=\"table-\" v-for=\"(cate,index) in allResourceCate\" :class=\"index===0?'top-line':null\" :key=\"'cate'+cate.id\">\n      <!-- 创建资源分类的全选复选框 -->\n      <el-row class=\"table-layout\" style=\"background: #F2F6FC;\">\n        <el-checkbox v-model=\"cate.checked\" :indeterminate=\"isIndeterminate(cate.id)\" @change=\"handleCheckAllChange(cate)\">\n          {{cate.name}}\n        </el-checkbox>\n      </el-row>\n      <!-- 遍历资源并创建复选框 -->\n      <el-row class=\"table-layout\">\n        <el-col :span=\"8\" v-for=\"resource in getResourceByCate(cate.id)\" :key=\"resource.id\" style=\"padding: 4px 0\">\n          <el-checkbox v-model=\"resource.checked\" @change=\"handleCheckChange(resource)\">\n            {{resource.name}}\n          </el-checkbox>\n        </el-col>\n      </el-row>\n    </div>\n    <!-- 操作按钮区域 -->\n    <div style=\"margin-top: 20px\" align=\"center\">\n      <el-button type=\"primary\" @click=\"handleSave()\">保存</el-button>\n      <el-button @click=\"handleClear()\">清空</el-button>\n    </div>\n  </el-card>\n</template>\n\n<script>\nimport { fetchAllResourceList } from '@/api/resource';\nimport { listAllCate } from '@/api/resourceCategory';\nimport { allocResource, listResourceByRole } from '@/api/role';\n\nexport default {\n  name: \"allocResource\",\n  data () {\n    return {\n      roleId: null,\n      allResource: null,\n      allResourceCate: null\n    };\n  },\n  created () {\n    // 从路由中获取角色ID\n    this.roleId = this.$route.query.roleId;\n    // 获取所有资源分类\n    this.getAllResourceCateList();\n  },\n  methods: {\n    // 获取所有资源列表\n    getAllResourceList () {\n      fetchAllResourceList().then(response => {\n        this.allResource = response.data;\n        // 初始化资源的选中状态\n        for (let i = 0; i < this.allResource.length; i++) {\n          this.allResource[i].checked = false;\n        }\n        // 获取角色已分配的资源\n        this.getResourceByRole(this.roleId);\n      });\n    },\n    // 获取所有资源分类列表\n    getAllResourceCateList () {\n      listAllCate().then(response => {\n        this.allResourceCate = response.data;\n        // 初始化资源分类的选中状态\n        for (let i = 0; i < this.allResourceCate.length; i++) {\n          this.allResourceCate[i].checked = false;\n        }\n        // 获取所有资源列表\n        this.getAllResourceList();\n      });\n    },\n    // 根据资源分类ID过滤资源数据\n    getResourceByCate (categoryId) {\n      let cateResource = [];\n      if (this.allResource == null) return null;\n      for (let i = 0; i < this.allResource.length; i++) {\n        let resource = this.allResource[i];\n        if (resource.categoryId === categoryId) {\n          cateResource.push(resource);\n        }\n      }\n      return cateResource;\n    },\n    // 获取角色已分配的资源\n    getResourceByRole (roleId) {\n      listResourceByRole(roleId).then(response => {\n        let allocResource = response.data;\n        this.allResource.forEach(item => {\n          item.checked = this.getResourceChecked(item.id, allocResource);\n        });\n        this.allResourceCate.forEach(item => {\n          item.checked = this.isAllChecked(item.id);\n        });\n        this.$forceUpdate();\n      });\n    },\n    // 检查资源是否已选中\n    getResourceChecked (resourceId, allocResource) {\n      if (allocResource == null || allocResource.length === 0) return false;\n      for (let i = 0; i < allocResource.length; i++) {\n        if (allocResource[i].id === resourceId) {\n          return true;\n        }\n      }\n      return false;\n    },\n    // 判断资源分类的选中状态是否不确定\n    isIndeterminate (categoryId) {\n      let cateResources = this.getResourceByCate(categoryId);\n      if (cateResources == null) return false;\n      let checkedCount = 0;\n      for (let i = 0; i < cateResources.length; i++) {\n        if (cateResources[i].checked === true) {\n          checkedCount++;\n        }\n      }\n      return !(checkedCount === 0 || checkedCount === cateResources.length);\n    },\n    // 判断资源分类的选中状态是否全部选中\n    isAllChecked (categoryId) {\n      let cateResources = this.getResourceByCate(categoryId);\n      if (cateResources == null) return false;\n      let checkedCount = 0;\n      for (let i = 0; i < cateResources.length; i++) {\n        if (cateResources[i].checked === true) {\n          checkedCount++;\n        }\n      }\n      if (checkedCount === 0) {\n        return false;\n      }\n      return checkedCount === cateResources.length;\n    },\n    // 保存资源分配\n    handleSave () {\n      this.$confirm('是否分配资源？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        let checkedResourceIds = new Set();\n        if (this.allResource != null && this.allResource.length > 0) {\n          this.allResource.forEach(item => {\n            if (item.checked) {\n              checkedResourceIds.add(item.id);\n            }\n          });\n        }\n        let params = new URLSearchParams();\n        params.append(\"roleId\", this.roleId);\n        params.append(\"resourceIds\", Array.from(checkedResourceIds));\n        // 调用后端API进行资源分配\n        allocResource(params).then(response => {\n          this.$message({\n            message: '分配成功',\n            type: 'success',\n            duration: 1000\n          });\n          // 返回上一页\n          this.$router.back();\n        })\n      })\n    },\n    // 清空所有选择\n    handleClear () {\n      this.allResourceCate.forEach(item => {\n        item.checked = false;\n      });\n      this.allResource.forEach(item => {\n        item.checked = false;\n      });\n      this.$forceUpdate();\n    },\n    // 处理资源分类全选状态变化\n    handleCheckAllChange (cate) {\n      let cateResources = this.getResourceByCate(cate.id);\n      for (let i = 0; i < cateResources.length; i++) {\n        cateResources[i].checked = cate.checked;\n      }\n      this.$forceUpdate();\n    },\n    // 处理资源复选框状态变化\n    handleCheckChange (resource) {\n      this.allResourceCate.forEach(item => {\n        if (item.id === resource.categoryId) {\n          item.checked = this.isAllChecked(resource.categoryId);\n        }\n      });\n      this.$forceUpdate();\n    }\n  }\n}\n</script>\n\n<style scoped>\n.table-layout {\n  padding: 20px;\n  border-left: 1px solid #dcdfe6;\n  border-right: 1px solid #dcdfe6;\n  border-bottom: 1px solid #dcdfe6;\n}\n\n.top-line {\n  border-top: 1px solid #dcdfe6;\n}\n/* .table- {\n  display: block;\n  margin: 60px;\n}\n.form-container {\n  height: 700px;\n  display: block;\n} */\n</style>\n"]}]}