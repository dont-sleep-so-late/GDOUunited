{"remainingRequest":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\src\\pages\\filedata\\reward.vue?vue&type=style&index=0&id=e13c9538&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\src\\pages\\filedata\\reward.vue","mtime":1709141608747},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\css-loader\\dist\\cjs.js","mtime":1710918918955},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1710918931246},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\postcss-loader\\src\\index.js","mtime":1710918925966},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710918915895},{"path":"C:\\Users\\DIO\\Desktop\\云统战\\GDOUunited\\node_modules\\vue-loader\\lib\\index.js","mtime":1710918931244}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQo6OnYtZGVlcCAgLmVsLXBhZ2luYXRpb257DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiA2NTBweDsNCiAgbGVmdDogNDUlOw0KfQ0KLmNlbGx7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0K"},{"version":3,"sources":["reward.vue"],"names":[],"mappings":";AAoZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"reward.vue","sourceRoot":"src/pages/filedata","sourcesContent":["<template>\r\n  <div>\r\n  <!-- 新增上传 -->\r\n    <el-button type=\"primary\" @click=\"addDialogVisible()\" size=\"small\">资料上传</el-button>\r\n    <el-dialog title=\"新增上传\" :visible.sync=\"dialogFormVisible\" :show-close=\"false\" >\r\n\r\n      <h2 style=\"textAlign:center;marginBottom:10px\">资料上传</h2>\r\n\r\n      <el-form label-width=\"120px\" >\r\n          <el-form-item label=\"获奖人\" prop=\"people\">\r\n            <el-input v-model=\"fileData.name\" placeholder=\"请填写获奖人\" @blur=\"getPersonId\" />\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"奖励名称\" prop=\"title\">\r\n            <el-input v-model=\"fileData.pPriceName\" placeholder=\"请填写具体名称\" />\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"奖励等级\"  style=\"marginTop:10px\" >\r\n            <el-select v-model=\"fileData.pLevel\" clearable placeholder=\"请选择奖励等级\" >\r\n                      <el-option\r\n                      v-for=\"item in levOptions\"\r\n                      :key=\"item.value\"\r\n                      :label=\"item.label\"\r\n                      :value=\"item.value\">\r\n                    </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          \r\n          <el-form-item label=\"添加文件\">\r\n            <el-upload ref=\"upload\"          \r\n              :auto-upload=\"false\" \r\n              :http-request=\"fileUpload\"\r\n              :file-list=\"fileList\" \r\n              :on-remove=\"handleRemove\" \r\n              \r\n              class=\"upload-demo\" \r\n              action=\"#\"\r\n              drag  \r\n              multiple>\r\n            <i class=\"el-icon-upload\" />\r\n            <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n            <div slot=\"tip\" class=\"el-upload__tip\" style=\"color:red\">支持PDF,Word等文件</div>\r\n            </el-upload>\r\n          </el-form-item>\r\n      </el-form>\r\n      \r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button  @click=\"dialogVisible()\">取 消</el-button>\r\n        <el-button type=\"primary\"  @click=\"saveAdd()\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n  <!-- 修改功能 -->\r\n    <el-button size=\"small\" style=\"marginLeft:10px\" @click=\"alterReward()\" >修改</el-button>\r\n    <el-dialog title=\"修改信息\" :visible.sync=\"alterFormVisible\" :show-close=\"false\">\r\n\r\n      <h2 style=\"textAlign:center\">修改信息</h2>\r\n\r\n      <el-form label-width=\"120px\">\r\n          <el-form-item label=\"获奖人\" prop=\"people\">\r\n            <el-input v-model=\"fileData.name\" placeholder=\"请填写获奖人\" @blur=\"getPersonId\"/>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"奖励名称\" prop=\"title\">\r\n            <el-input v-model=\"fileData.pPriceName\" placeholder=\"请填写具体名称\" />\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"奖励等级\"  style=\"marginTop:10px\" >\r\n            <el-select v-model=\"fileData.pLevel\" clearable placeholder=\"请选择奖励等级\" >\r\n                      <el-option\r\n                      v-for=\"item in levOptions\"\r\n                      :key=\"item.value\"\r\n                      :label=\"item.label\"\r\n                      :value=\"item.value\">\r\n                    </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"添加文件\">\r\n            <el-upload ref=\"update\"          \r\n              :auto-upload=\"false\"\r\n              :http-request=\"fileUpload\"\r\n              :file-list=\"fileList\"\r\n              :on-remove=\"handleRemove\"\r\n              class=\"upload-demo\" \r\n              action=\"#\"\r\n              drag  \r\n              multiple>\r\n            <i class=\"el-icon-upload\" />\r\n            <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n            <div slot=\"tip\" class=\"el-upload__tip\" style=\"color:red\">支持PDF,Word等文件</div>\r\n            </el-upload>\r\n          </el-form-item>\r\n      </el-form>\r\n\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button  @click=\"alterClose()\">取 消</el-button>\r\n        <el-button type=\"primary\"  @click=\"saveUpdate()\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  \r\n  <!-- 删除功能 -->\r\n    <el-button  type=\"danger\" size=\"small\" style=\"marginLeft:10px\" @click=\"removeData\">删除</el-button>\r\n\r\n  <!-- 查询功能 -->\r\n    <template>\r\n    <el-form :inline=\"true\"  class=\"demo-form-inline\">\r\n      <el-form-item label=\"获奖人员\"  style=\"marginTop:10px\">\r\n        <el-input v-model=\" searchMsg.searchPerson\" placeholder=\"请输入获奖人名\" size=\"small\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"获奖名称\" style=\"marginTop:10px\">\r\n        <el-input  v-model=\" searchMsg.searchReward\" placeholder=\"请输入获奖名称\" size=\"small\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item>\r\n      <el-button type=\"primary\"  size=\"small\" style=\"marginTop:14px\" @click=\"searchReward\">查询</el-button>\r\n      <el-button style=\"marginLeft:10px\" size=\"small\" @click=\"reset\">查询所有</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    </template>\r\n\r\n  <!-- 展示区 -->\r\n    <el-table :data=\"rewardData\" style=\"width:100%\" :border=true  @selection-change=\"handleSelectionChange\">\r\n      <el-table-column label=\"勾选\" width=\"55px\" type=\"selection\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"name\" label=\"获奖人\" align=\"center\" >\r\n      </el-table-column>\r\n      <el-table-column prop=\"ppriceName\" label=\"获奖名称\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"puploadTime\" label=\"日期\" align=\"center\">\r\n      </el-table-column>    \r\n    </el-table>\r\n   \r\n  <!-- 分页器 -->\r\n    <el-pagination \r\n      layout=\"prev,pager,next,jumper\"\r\n      :total=\"total\"\r\n      :current-current.sync=\"p.current\" \r\n      :page-size=\"p.number\" \r\n      @current-change=\"handleCurrentChange\">\r\n    </el-pagination> \r\n    <!-- style=\"marginTop:100px; textAlign:center\"  -->\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { reqRewardData, reqRewardAddMsg, reqRewardRemove, reqRewardUpdataMsg, reqRewardSearch, reqRewardFile, reqPersonId,reqRewardId } from \"@/api/fileData/reward\"\r\n\r\nexport default {\r\n  name: \"reward\",\r\n  mounted() {\r\n  console.log(this.$route); // 当前路由对象\r\n},\r\n  data() {\r\n    return {\r\n      fileData: {\r\n        id: \"\",\r\n        name: \"\",\r\n        pPriceName: \"\",\r\n        pLevel: \"\",\r\n      },\r\n      fileList:[],\r\n      dialogFormVisible: false, //上传功能对话框\r\n      alterFormVisible:false,   //修改功能对话框\r\n      multipleSelection: [],\r\n      levOptions: [{\r\n        value: \"省级\",\r\n        label:\"省级\"\r\n      }, {\r\n        value: \"国家级\",\r\n        label:\"国家级\"\r\n      }],\r\n      searchMsg: {        //查询需要用的变量\r\n        searchReward: null,\r\n        searchPerson: null,\r\n      },\r\n      rewardData: [],\r\n      p: {                //发起查询的参数\r\n        current: 1,\r\n        number: 6\r\n      },\r\n      total: 0,\r\n      flag:true\r\n    }\r\n  },\r\n  computed: {\r\n    pid() {\r\n      return this.$store.state.reward.pid\r\n    },\r\n  },\r\n  watch: {\r\n    searchMsg: {\r\n      deep: true,\r\n      handler(newVal, oldVal) {\r\n        this.p.current=1\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    async fileUpload(info) {\r\n      const {file} =info\r\n      const fd = new FormData()\r\n      fd.append(\"file\", file);\r\n      fd.append(\"pid\",this.fileData.id)\r\n      try { \r\n        let result = await reqRewardFile(fd)\r\n        this.fileList=[]\r\n      } catch (error) {\r\n        \r\n      }\r\n    },\r\n    handleRemove(file,fileList) {\r\n      console.log(file,fileList);\r\n    },\r\n\r\n    //页码框获取相应页数的数据\r\n    handleCurrentChange(pager) {\r\n      this.p.current = pager\r\n      if (this.flag) {\r\n        this.getRewardData()\r\n      } else {\r\n        this.searchReward()\r\n      }\r\n    },\r\n\r\n    //展示选中以后\r\n    handleSelectionChange(msg) {\r\n      let idArr = []\r\n      msg.forEach((item) => {\r\n        idArr.push(item.pid)\r\n      })\r\n      this.$store.dispatch(\"reward/SelectionChange\", idArr)\r\n    },\r\n\r\n\r\n    //判断勾选按钮的个数，修改功能只能勾选一个\r\n    async alterReward() {\r\n        if (this.pid.length === 0) {\r\n        alert(\"请勾选修改的内容\")\r\n      } else if(this.pid.length === 1){\r\n          this.alterFormVisible = true\r\n          const result = await reqRewardId(this.pid[0])\r\n          this.fileData.name = result.data.name\r\n          this.fileData.pLevel = result.data.plevel\r\n          this.fileData.pPriceName = result.data.ppriceName\r\n      } else if (this.pid.length > 1) {\r\n        alert(\"至多修改一条信息\")\r\n      }\r\n    },\r\n\r\n    //关闭新增上传功能对话框\r\n    dialogVisible() {\r\n      this.fileData.id = \"\"\r\n      this.fileData.name = \"\"\r\n      this.fileData.pPriceName = \"\"\r\n      this.fileData.pLevel = \"\"\r\n      this.dialogFormVisible=false\r\n    },\r\n\r\n    //打开新增上传功能对话框\r\n    addDialogVisible() {\r\n      this.fileData.id = \"\"\r\n      this.fileData.name = \"\"\r\n      this.fileData.pPriceName = \"\"\r\n      this.fileData.pLevel = \"\"\r\n      this.dialogFormVisible=true\r\n    },\r\n\r\n    //修改功能对话框\r\n    alterClose() {\r\n      this.fileData.id = \"\"\r\n      this.fileData.name = \"\"\r\n      this.fileData.pPriceName = \"\"\r\n      this.fileData.pLevel = \"\"\r\n      this.alterFormVisible = false\r\n    },\r\n\r\n    //获取用户数据\r\n    async getRewardData() {\r\n      try {\r\n        const result = await reqRewardData(this.p)\r\n        console.log(result);\r\n        result.data.prices.forEach((item) => {\r\n          item.puploadTime = item.puploadTime.slice(0, 10)\r\n        })\r\n        this.rewardData = result.data.prices\r\n        this.total = result.data.total\r\n      } catch (error) {\r\n        \r\n      }\r\n    },\r\n\r\n    //获取用户ID\r\n    async getPersonId() {\r\n      if (this.fileData.name) {\r\n        let result = await reqPersonId(this.fileData.name)\r\n        if (result.data.length) {\r\n          this.fileData.id = result.data[0].id\r\n        } else {\r\n          this.fileData.name=\"\"\r\n          alert(\"当前系统无数据，请输入正确姓名\");\r\n        }\r\n      }\r\n    },\r\n\r\n    //新增上传提交\r\n    async saveAdd() {\r\n      if (this.fileData.name && this.fileData.pPriceName.trim() && this.fileData.pLevel) {\r\n        //调用上传文件信息\r\n        try {\r\n          let result = await reqRewardAddMsg(this.fileData)\r\n          this.$refs.upload.submit();\r\n          this.fileData.id = \"\"\r\n          this.fileData.name = \"\"\r\n          this.fileData.pPriceName = \"\"\r\n          this.fileData.pLevel = \"\"\r\n          this.dialogFormVisible = false\r\n          this.getRewardData()\r\n          alert(\"上传成功\")\r\n        } catch (error) {\r\n          alert(\"上传连接失败\")\r\n        }  \r\n      } else {\r\n        alert(\"请输入完整的获奖信息\")\r\n      }\r\n    },\r\n\r\n    //修改提交\r\n    async saveUpdate() {\r\n      if (this.fileData.name && this.fileData.pPriceName.trim()  && this.fileData.pLevel) {\r\n        const updataMsg = {\r\n          id: this.fileData.id,\r\n          pid: this.pid[0],\r\n          name: this.fileData.name,\r\n          pPriceName: this.fileData.pPriceName,\r\n          pLevel:this.fileData.pLevel\r\n        }\r\n        let result = await reqRewardUpdataMsg(updataMsg)\r\n        this.$refs.update.submit();\r\n        this.fileData.id = \"\"\r\n        this.fileData.name = \"\"\r\n        this.fileData.pPriceName = \"\"\r\n        this.fileData.pLevel = \"\"\r\n        this.alterFormVisible = false\r\n        this.getRewardData()\r\n        alert(\"修改成功\")\r\n      } else {\r\n        alert(\"请输入完整的获奖信息\")\r\n      }\r\n    },\r\n\r\n     //删除功能\r\n    async removeData() {\r\n      if (this.pid.length !== 0) {\r\n        try {\r\n          for (let i = 0; i < this.pid.length; i++) {\r\n            let result = await reqRewardRemove(this.pid[i])\r\n          }\r\n          this.getRewardData()\r\n        } catch (error) {\r\n          // alert(error.message)\r\n        }\r\n      } else {\r\n        alert(\"未选择任何项\")\r\n      }\r\n    },\r\n\r\n    //查询文章  \r\n    async searchReward() {\r\n      if (this.searchMsg.searchReward || this.searchMsg.searchPerson) {\r\n        try {    \r\n          let result = await reqRewardSearch(this.searchMsg,this.p)\r\n          result.data.prices.forEach(item => {\r\n              item.puploadTime = item.puploadTime.slice(0, 10)\r\n          })\r\n          this.searchMsg.searchPerson=null\r\n          this.searchMsg.searchReward=null\r\n          this.rewardData = result.data.prices\r\n          this.total = result.data.total\r\n          this.flag = false\r\n        }catch (error) {\r\n         \r\n        }\r\n      } else {\r\n        alert(\"请输入查询内容\")\r\n      }\r\n    },\r\n\r\n    //查询所有\r\n    reset() {\r\n      this.searchMsg.searchPerson=null\r\n      this.searchMsg.searchReward = null\r\n      this.p.current=1\r\n      this.flag=true\r\n      this.getRewardData()\r\n    }\r\n  },\r\n  created() {\r\n    //获取获奖数据\r\n    this.getRewardData()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n::v-deep  .el-pagination{\r\n  position: absolute;\r\n  top: 650px;\r\n  left: 45%;\r\n}\r\n.cell{\r\n  text-align: center;\r\n}\r\n\r\n</style>\r\n"]}]}